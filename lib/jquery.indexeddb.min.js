(function(g){function s(g){var e=null;switch(g){case 0:case 1:case "readwrite":case "readonly":e=g;break;default:e=t.READ_WRITE||"readwrite"}return e}var q=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,u=window.IDBKeyRange||window.webkitIDBKeyRange,k=window.IDBCursor||window.webkitIDBCursor||{};"undefined"===typeof k.PREV&&(k.PREV="prev");"undefined"===typeof k.NEXT&&(k.NEXT="next");var t=window.IDBTransaction||window.webkitIDBTransaction;g.extend({indexedDB:function(k,
e){if(e){"number"===typeof e&&(e={version:e});var n=e.version;if(e.g&&!n){var l=-1,m;for(m in e.g)l=l>m?l:m;n=e.version||l}}var f={request:function(a,b){return g.f(function(d){try{var c="function"===typeof a?a(b):a;c.onsuccess=function(a){d.e(c,[c.result,a])};c.onerror=function(a){d.a(c,[c.error,a])};"undefined"!==typeof c.onblocked&&null===c.onblocked&&(c.onblocked=function(a){var b;try{b=c.result}catch(h){b=null}d.d(c,[b,a])});"undefined"!==typeof c.onupgradeneeded&&null===c.onupgradeneeded&&(c.onupgradeneeded=
function(a){d.d(c,[c.result,a])})}catch(h){h.name="exception",d.a(c,["exception",h])}})},transaction:function(a){return{objectStore:function(b){try{return f.objectStore(a.objectStore(b))}catch(d){return a.readyState!==a.DONE&&a.abort(),f.objectStore(null)}},createObjectStore:function(b,d){try{return f.objectStore(a.db.createObjectStore(b,d))}catch(c){a.readyState!==a.DONE&&a.abort()}},deleteObjectStore:function(b){try{a.db.deleteObjectStore(b)}catch(d){a.readyState!==a.DONE&&a.abort()}},abort:function(){a.abort()}}},
objectStore:function(a){for(var b={},d="add put get delete clear count".split(" "),c=0;c<d.length;c++)b[d[c]]=function(c){return function(){return f.b(function(b){return a[c].apply(a,b)},arguments)}}(d[c]);b.j=function(c,b,d){return f.cursor(function(){return d?a.openCursor(f.c(b),d):a.openCursor(f.c(b))},c)};b.index=function(c){return f.index(function(){return a.index(c)})};b.createIndex=function(c,b,d){2===arguments.length&&"string"===typeof b&&(d=arguments[1],b=null);d||(d=c);return f.index(function(){return a.createIndex(d,
c,b)})};b.deleteIndex=function(c){return a.deleteIndex(c)};return b},range:function(a){return g.isArray(a)?1===a.length?u.only(a[0]):u.bound(a[0],a[1],"undefined"===typeof a[2]?!1:a[2],"undefined"===typeof a[3]?!1:a[3]):"undefined"===typeof a?null:a},cursor:function(a,b){return g.f(function(d){try{var c="function"===typeof a?a():a;c.onsuccess=function(a){if(c.result){var h={"delete":function(){return f.b(function(){return c.result["delete"]()})},update:function(a){return f.b(function(){return c.result.update(a)})},
next:function(a){this.data=a},key:c.result.key,value:c.result.value};d.d(c,[h,a]);var e=b.apply(c,[h]);try{if(!1===e)d.e(c,[null,a]);else if("number"===typeof e)c.result.advance.apply(c.result,[e]);else if(h.data)c.result["continue"].apply(c.result,[h.data]);else c.result["continue"]()}catch(g){d.a(c,[c.result,g])}}else d.e(c,[null,a])};c.onerror=function(a){d.a(c,[c.result,a])}}catch(h){h.type="exception",d.a(c,[null,h])}})},index:function(a){try{var b="function"===typeof a?a():a}catch(d){b=null}return{each:function(a,
d,e){return f.cursor(function(){return e?b.openCursor(f.c(d),e):b.openCursor(f.c(d))},a)},eachKey:function(a,d,e){return f.cursor(function(){return e?b.openKeyCursor(f.c(d),e):b.openKeyCursor(f.c(d))},a)},get:function(a){return"function"===typeof b.get?f.b(b.get(a)):b.openCursor(f.c(a))},count:function(){if("function"===typeof b.count)return f.b(b.count());throw"Count not implemented for cursors";},getKey:function(a){return"function"===typeof b.getKey?f.b(b.getKey(a)):b.openKeyCursor(f.c(a))}}}},
p=f.b(function(){return n?q.open(k,parseInt(n)):q.open(k)});p.then(function(a){a.onversionchange=function(){e&&e.onversionchange&&!1!==e.onversionchange()||a.close()}},function(){},function(a,b){if(b&&"upgradeneeded"===b.type){if(e&&e.g)for(var d=b.oldVersion+1;d<=b.newVersion;d++)"function"===typeof e.g[d]&&e.g[d].call(this,f.transaction(this.transaction));e&&"function"===typeof e.h&&e.h.call(this,f.transaction(this.transaction))}});return g.extend(p,{cmp:function(a,b){return q.i(a,b)},deleteDatabase:function(){return g.f(function(a){p.then(function(b){b.close();
f.b(function(){return q.deleteDatabase(k)}).then(function(b,c){a.e(this,[b,c])},function(b,c){a.a(this,[b,c])},function(b,c){a.d(this,[b,c])})},function(b,d){a.a(this,[b,d])},function(b,d){a.d(this,[b,d])})})},transaction:function(a,b){!g.isArray(a)&&(a=[a]);b=s(b);return g.f(function(d){p.then(function(c){var e;try{e=c.transaction(a,b),e.onabort=e.onerror=function(a){d.a(e,[a])},e.oncomplete=function(a){d.e(e,[a])}}catch(g){g.type="exception";d.a(this,[g]);return}try{d.d(e,[f.transaction(e)])}catch(k){k.type=
"exception",d.a(this,[k])}},function(a,b){d.a(this,[b,a])},function(){})})},objectStore:function(a,b){function d(c){return g.f(function(d){function g(b,c){try{c(b.objectStore(a)).then(function(a,b){d.e(this,[a,b])},function(a,b){d.a(this,[a,b])})}catch(e){e.name="exception",d.a(b,[e,e])}}n.transaction(a,s(b)).then(function(){},function(h,l){if(h.code!==h.NOT_FOUND_ERR||!0!==b&&"object"!==typeof b)d.a(this,[h,l]);else{var m=this.result;m.close();p=f.b(function(){return q.open(k,(parseInt(m.version,
10)||1)+1)});p.then(function(f){f.onversionchange=function(){e&&e.onversionchange&&!1!==e.onversionchange()||f.close()};n.transaction(a,s(b)).then(function(){},function(a,b){d.a(this,[a,b])},function(a){g(a,c)})},function(a,b){d.a(this,[a,b])},function(c,e){if("upgradeneeded"===e.type)try{c.createObjectStore(a,!0===b?{autoIncrement:!0}:b)}catch(f){d.a(this,[f,e])}})}},function(a){g(a,c)})})}function c(a,b){return d(function(c){return c[a].apply(c,b)})}function h(a,b,c){return d(function(d){d=d.index(b);
return d[a].apply(d[a],c)})}for(var n=this,l={},m="add delete get put clear count each".split(" "),r=0;r<m.length;r++)l[m[r]]=function(a){return function(){return c(a,arguments)}}(m[r]);l.index=function(a){return{each:function(b,c,d){return h("each",a,[b,c,d])},eachKey:function(b,c,d){return h("eachKey",a,[b,c,d])},get:function(b){return h("get",a,[b])},count:function(){return h("count",a,[])},getKey:function(b){return h("getKey",a,[b])}}};return l}})}});g.indexedDB.IDBCursor=k;g.indexedDB.IDBTransaction=
t;g.k=g.indexedDB})(jQuery);